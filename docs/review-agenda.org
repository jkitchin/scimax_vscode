#+TITLE: Documentation Review Agenda
#+AUTHOR: Scimax VSCode
#+TODO: âš ï¸ ðŸ‘€ | âœ…

This file generates a dynamic agenda of documentation headings that need review.
Headings marked with âš ï¸ are new and need inspection before being marked âœ….

* Generate Review Agenda

Run this block (C-c C-c) to generate the current review agenda from docs/*.org files.

#+begin_src sh 

echo "* Review Agenda"
echo ""

total=0
for file in *.org; do
    [ "$file" = "review-agenda.org" ] && continue

    # Find lines with âš ï¸ or ðŸ‘€ headings
    matches=$(grep -n "^\*.*âš ï¸\|^\*.*ðŸ‘€" "$file" 2>/dev/null || true)

    if [ -n "$matches" ]; then
        count=$(echo "$matches" | wc -l | tr -d ' ')
        total=$((total + count))
        echo "** [[file:$file][$file]] ($count items)"
        echo "$matches" | while IFS=: read -r linenum content; do
            # Extract the heading title (remove stars and TODO keyword)
            title=$(echo "$content" | sed 's/^\*\+ //' | sed 's/^âš ï¸ //' | sed 's/^ðŸ‘€ //')
            echo "   - [[file:$file::$linenum][$title]]"
        done
        echo ""
    fi
done

if [ "$total" -eq 0 ]; then
    echo "No items marked with âš ï¸ or ðŸ‘€ found. All documentation reviewed!"
else
    echo "Total: $total items need review"
fi
#+end_src

#+RESULTS:
: * Review Agenda
: 
: ** [[file:01-getting-started.org][01-getting-started.org]] (1 items)
:    - [[file:01-getting-started.org::90][** âš ï¸ Updating the Extension]]
: 
: Total: 1 items need review


* Current Review Status
:PROPERTIES:
:VISIBILITY: folded
:END:

The results from running the above block will appear here after execution.
Items link directly to the source file and line number for quick navigation.

** Workflow

1. Run the source block above with `C-c C-c'
2. Click on any item link to jump to that heading
3. Review the content
4. Change the heading's TODO state from âš ï¸ to âœ… when satisfied
5. Re-run the block to update the agenda

** Legend

| State | Meaning                       |
|-------+-------------------------------|
| âš ï¸    | New heading, needs review     |
| ðŸ‘€    | Changed heading, needs review |
| âœ…    | Reviewed and approved         |

                                                                                                                                                                  
     
* Add Review Markers to Unmarked Headings

Run this block to add âš ï¸ to all headings that do not have a TODO state.

#+begin_src python :results output
import os, re

TODO_STATES = ["âš ï¸", "ðŸ‘€", "âœ…", "TODO", "DONE", "NEXT", "WAITING", "CANCELLED"]

def has_todo(line):
    m = re.match(r"^\*+\s+(.*)$", line)
    if not m: return True
    first = m.group(1).split()[0] if m.group(1).split() else ""
    return first in TODO_STATES

total = 0
for fname in sorted(os.listdir(".")):
    if not fname.endswith(".org") or fname == "review-agenda.org": continue
    with open(fname, "r") as f: lines = f.readlines()
    new_lines, changes = [], []
    for i, line in enumerate(lines):
        if re.match(r"^\*+\s", line) and not has_todo(line):
            new_lines.append(re.sub(r"^(\*+\s+)", r"\1âš ï¸ ", line))
            changes.append(f"  Line {i+1}: {line.strip()}")
        else:
            new_lines.append(line)
    if changes:
        with open(fname, "w") as f: f.writelines(new_lines)
        print(f"\n{fname}:")
        for c in changes: print(c)
        total += len(changes)

print(f"\nTotal: {total} headings updated" if total else "All headings have TODO states.")
#+end_src

* Add Review Markers (TypeScript API)

Uses the scimax org modification API to add âš ï¸ markers to unmarked headings.

#+begin_src typescript :results output
import { org } from './src/parser/orgModify';
import * as fs from 'fs';

const TODO_STATES = ['âš ï¸', 'ðŸ‘€', 'âœ…', 'TODO', 'DONE', 'NEXT', 'WAITING', 'CANCELLED'];
let total = 0;

for (const fname of fs.readdirSync('.').filter(f => f.endsWith('.org') && f !== 'review-agenda.org')) {
    const doc = org.parseFile(fname);
    let changes: string[] = [];

    org.mapHeadlines(doc, h => {
        if (!h.properties.todoKeyword || !TODO_STATES.includes(h.properties.todoKeyword)) {
            h.properties.todoKeyword = 'âš ï¸';
            h.properties.todoType = 'todo';
            changes.push(`  Line ${h.properties.lineNumber}: ${h.properties.rawValue}`);
        }
    });

    if (changes.length > 0) {
        org.writeFile(fname, doc);
        console.log(`\n${fname}:`);
        changes.forEach(c => console.log(c));
        total += changes.length;
    }
}

console.log(total > 0 ? `\nTotal: ${total} headings updated` : 'All headings have TODO states.');
#+end_src