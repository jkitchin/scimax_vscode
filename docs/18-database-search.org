#+TITLE: Database and Search
#+AUTHOR: Scimax VS Code Team
#+DATE: 2026-01-13
#+STARTUP: overview
#+OPTIONS: toc:2 num:t H:4
#+TODO: ‚ö†Ô∏è üëÄ | ‚úÖ

* ‚úÖ Overview
CLOSED: [2026-01-17 Sat 11:45]

Scimax VS Code includes a powerful database and search system that indexes your org, markdown, and Jupyter notebook files. The database provides:

- *Full-text search* with FTS5 (SQLite's Full-Text Search) and BM25 ranking
- *Semantic search* using vector embeddings for meaning-based queries
- *Hybrid search* combining keyword and semantic approaches
- *Structured queries* for headings, TODOs, tags, properties, and links
- *Agenda views* for scheduled items and deadlines
- *Code block search* filtered by programming language

The database is built on SQLite (via `@libsql/client') with support for vector similarity search, making it both fast and capable of sophisticated semantic queries.

* ‚úÖ What Gets Indexed
CLOSED: [2026-01-17 Sat 11:45]

** ‚úÖ File Types
CLOSED: [2026-01-17 Sat 11:45]

The database automatically indexes three types of files:

- `.org' files - Org-mode documents
- `.md' files - Markdown documents
- `.ipynb' files - Jupyter notebooks

** ‚úÖ Indexed Content
CLOSED: [2026-01-17 Sat 11:45]

For each file, the database extracts and indexes:

*** ‚úÖ Headings
CLOSED: [2026-01-17 Sat 11:45]
- Heading text and level (*, **, ***, etc.)
- TODO states (TODO, DONE, IN-PROGRESS, etc.)
- Priority markers ([#A], [#B], [#C])
- Tags (both direct and inherited)
- Properties (CUSTOM_ID, CATEGORY, etc.)
- Scheduling information (SCHEDULED, DEADLINE, CLOSED)
- Line numbers for navigation

*** ‚úÖ Source Blocks
CLOSED: [2026-01-17 Sat 11:45]
- Programming language
- Complete code content
- Header arguments (`:results', `:exports', etc.)
- Line numbers
- For notebooks: cell indices

*** ‚úÖ Links
CLOSED: [2026-01-17 Sat 11:45]
- Link type (file, http, https, id, etc.)
- Target path or URL
- Optional description text
- Line number

*** ‚úÖ Hashtags
CLOSED: [2026-01-17 Sat 11:45]
- Inline hashtags (e.g., #research, #todo)
- Associated file paths

*** ‚úÖ Full Text
CLOSED: [2026-01-17 Sat 11:45]
- Complete document content for full-text search
- Indexed with FTS5 virtual tables
- Porter stemming and Unicode normalization

Here is a hashtag #FullTextSearch


*** ‚úÖ Text Chunks (for Semantic Search)
CLOSED: [2026-01-17 Sat 11:46]
- Document divided into ~2000 character chunks
- 3-line overlap between chunks for context
- Vector embeddings (if embedding service configured)
- Line ranges for each chunk

** ‚úÖ File Watching
CLOSED: [2026-01-18 Sun 11:43]

The database automatically watches for file changes:

- New files are indexed when created
- Modified files are re-indexed (debounced with 500ms delay)
- Deleted files are removed from the index
- Changes are queued and processed sequentially

** ‚úÖ Ignore Patterns
CLOSED: [2026-01-17 Sat 11:46]

By default, the following patterns are ignored:

- `**/node_modules/**'
- `**/.git/**'
- `**/dist/**'
- `**/build/**'
- `**/.ipynb_checkpoints/**'

Configure additional patterns in settings: `scimax.db.ignorePatterns'

[[cmd:workbench.action.openSettings2]]

[[cmd:workbench.action.openSettings2?@scimax][Open Scimax Settings]]        

* ‚úÖ Full-Text Search
CLOSED: [2026-01-17 Sat 11:46]

** ‚úÖ Overview
CLOSED: [2026-01-17 Sat 11:46]

Full-text search uses SQLite's FTS5 (Full-Text Search version 5) with:

- *BM25 ranking* - Industry-standard relevance scoring
- *Porter stemming* - Matches word variations (e.g., "run" matches "running")
- *Unicode normalization* - Handles accented characters correctly
- *Snippet generation* - Shows matching context with highlighting

** ‚úÖ Usage
CLOSED: [2026-01-17 Sat 11:49]

*** ‚úÖ Command
CLOSED: [2026-01-17 Sat 11:49]
Run `Scimax: Search All Files (FTS5)' or use command `scimax.db.search'

[[cmd:scimax.db.search]]

*** ‚úÖ Query Syntax
CLOSED: [2026-01-17 Sat 11:49]

FTS5 supports rich query syntax:

**** ‚úÖ Basic Queries
CLOSED: [2026-01-17 Sat 11:49]

#+BEGIN_SRC org
machine learning          # Match both words (in any order)
"machine learning"        # Match exact phrase
neural OR artificial      # Match either word
#+END_SRC

**** Boolean Operators

#+BEGIN_SRC org
python AND jupyter        # Must contain both
python NOT tensorflow     # Contains python but not tensorflow
deep OR machine learning  # Contains "deep" or the phrase "machine learning"
#+END_SRC

**** Prefix Matching

#+BEGIN_SRC org
comput*                   # Matches: computer, computing, computation
data*                     # Matches: data, database, dataset
#+END_SRC

**** Column Queries

#+BEGIN_SRC org
title: introduction       # Search only in titles
content: python           # Search only in content
#+END_SRC

**** Proximity Queries

#+BEGIN_SRC org
NEAR(neural network, 5)   # Words within 5 tokens of each other
#+END_SRC

** Results

Search results include:

- File path and basename
- Line number
- Preview snippet with `<mark>' tags highlighting matches
- BM25 relevance score
- Up to 100 results (configurable)

** Example Searches

#+BEGIN_SRC org
# Find all references to "gradient descent"
gradient descent

# Find Python-related TODO items
TODO python

# Find documents about data science or machine learning
"data science" OR "machine learning"

# Find recent mentions of TensorFlow (excluding Keras)
tensorflow NOT keras

# Find all documents with "introduction" in title
title: introduction
#+END_SRC

* ‚úÖ Semantic Search
CLOSED: [2026-01-17 Sat 11:55]

** ‚úÖ Overview
CLOSED: [2026-01-17 Sat 11:55]

Semantic search finds content by *meaning* rather than exact words. It uses vector embeddings to represent text in a high-dimensional space where semantically similar content is close together.

Benefits:
- Find content even when using different words
- Discover related concepts
- More natural query language

Example: Searching for "machine learning algorithms" will also find documents about "neural networks", "deep learning models", and "classification methods" even if they don't contain those exact words.

** ‚úÖ Requirements
CLOSED: [2026-01-17 Sat 11:58]

Semantic search requires:

1. *Vector search support in libsql* - The database must support vector operations
2. *Embedding provider configured* - One of: local (Transformers.js), Ollama, or OpenAI
3. *Files indexed with embeddings* - Run `scimax.db.reindex' after configuring

*** Checking Availability

Run `Scimax: Show Database Stats' (`scimax.db.stats') to see:
- Whether vector search is supported
- Number of embeddings stored
- Any error messages

If vector search is unavailable, the stats will show:
#+BEGIN_EXAMPLE
Semantic search: Unavailable (vector search not supported)
#+END_EXAMPLE

*** Fallback to Full-Text Search

If semantic search is unavailable, use full-text search (`scimax.db.search') instead. FTS5 is always available and very fast for keyword-based queries.

** Embedding Providers

Scimax supports three embedding providers:

*** Local (Transformers.js) - Recommended
- *Pros*: Free, private, no external services needed
- *Cons*: Slower initial model download (~30MB)
- *Models*:
  - `Xenova/all-MiniLM-L6-v2' (384 dims, fast, recommended)
  - `Xenova/bge-small-en-v1.5' (384 dims, high quality)
  - `Xenova/gte-small' (384 dims, alternative)

*** Ollama
- *Pros*: Free, private, local control
- *Cons*: Requires Ollama installed and running
- *Models*:
  - `nomic-embed-text' (768 dims, recommended)
  - `all-minilm' (384 dims, smaller)
  - `mxbai-embed-large' (1024 dims, larger)
- *Setup*: Install Ollama, then `ollama pull nomic-embed-text'

*** ‚úÖ OpenAI
CLOSED: [2026-01-17 Sat 11:59]

- *Pros*: High quality, fast, maintained, supports batch embedding
- *Cons*: Requires API key, costs money, sends data to cloud
- *Security*: API key stored securely in OS credential manager (Keychain/Credential Manager/libsecret)
- *Model*: `text-embedding-3-small' (1536 dims) - currently the only model used
- *Note*: Model selection is not yet configurable; text-embedding-3-small is used automatically

** ‚úÖ Configuration
CLOSED: [2026-01-17 Sat 11:59]

*** ‚úÖ Interactive Setup
CLOSED: [2026-01-17 Sat 11:59]

Run `Scimax: Configure Embedding Service' (`scimax.db.configureEmbeddings')

This wizard will:
1. Let you choose a provider
2. Select a model
3. Test the connection
4. Update your settings
5. Prompt you to reindex files

*** ‚úÖ Manual Configuration
CLOSED: [2026-01-17 Sat 11:59]

Add to your VS Code settings (`settings.json'):

**** ‚úÖ Local (Transformers.js)
CLOSED: [2026-01-17 Sat 11:59]

#+BEGIN_SRC json
{
  "scimax.db.embeddingProvider": "local",
  "scimax.db.localModel": "Xenova/all-MiniLM-L6-v2"
}
#+END_SRC

**** ‚úÖ Ollama
CLOSED: [2026-01-17 Sat 12:00]

#+BEGIN_SRC json
{
  "scimax.db.embeddingProvider": "ollama",
  "scimax.db.ollamaUrl": "http://localhost:11434",
  "scimax.db.ollamaModel": "nomic-embed-text"
}
#+END_SRC

**** ‚úÖ OpenAI
CLOSED: [2026-01-18 Sat 12:00]

#+BEGIN_SRC json
{
  "scimax.db.embeddingProvider": "openai"
}
#+END_SRC

Note: The API key is stored securely in your OS credential manager, not in settings.json.
Use the interactive setup (`Scimax: Configure Embedding Service') to enter your API key.
Uses `text-embedding-3-small' model (1536 dimensions).

** ‚úÖ Usage
CLOSED: [2026-01-17 Sat 12:01]

*** ‚úÖ Command
CLOSED: [2026-01-17 Sat 12:01]
Run `Scimax: Semantic Search' or use command `scimax.db.searchSemantic'

*** ‚úÖ Query Examples
CLOSED: [2026-01-17 Sat 12:01]

Semantic search uses natural language:

#+BEGIN_SRC org
# Conceptual searches
explain neural network architecture
how to optimize database queries
project management best practices

# Related concept discovery
clustering algorithms    # Finds: k-means, hierarchical, DBSCAN
data visualization       # Finds: matplotlib, charts, plots, graphs

# Question answering
what is gradient descent
how does attention mechanism work
#+END_SRC

** Results

Results include:

- File path and line number
- Preview (first 200 characters of chunk)
- Similarity score (0-100%, higher is more relevant)
- Cosine distance (lower is more similar)
- Up to 20 results by default

** Reindexing for Semantic Search

After configuring an embedding provider, you *must reindex* your files:

1. Run `Scimax: Reindex Files' (`scimax.db.reindex')
2. Wait for indexing to complete
3. The database will generate embeddings for all text chunks
4. Semantic search will now be available

* Hybrid Search

** Overview

Hybrid search combines full-text (keyword) and semantic (vector) search using *Reciprocal Rank Fusion* (RRF). This approach:

- Gets the best of both worlds
- Balances exact matches with conceptual similarity
- Provides more robust results

** Usage

*** Command
Run `Scimax: Hybrid Search' or use command `scimax.db.searchHybrid'

*** How It Works

1. Query runs through both FTS5 and vector search
2. Results from each are ranked
3. RRF algorithm combines rankings:
   - Higher rank in either search boosts result
   - Results appearing in both searches rank highest
4. Final results sorted by combined score

*** Weights

Default weights are 50/50, but can be adjusted:

#+BEGIN_SRC typescript
// Internal API (for extension developers)
db.searchHybrid(query, {
  limit: 20,
  ftsWeight: 0.5,      // 50% weight on keywords
  vectorWeight: 0.5    // 50% weight on semantics
});
#+END_SRC

*** When to Use Hybrid

- Default choice for general searches
- When you want both exact matches and related concepts
- When query has both specific terms and broad concepts
- Example: "python sklearn classification accuracy" - finds both sklearn-specific code and general ML accuracy discussions

** Results

Results include:

- Combined ranking score
- Source indicator (Keywords, AI, or both)
- File location and preview
- Up to 20 results

* Structured Queries

Beyond free-text search, the database supports structured queries for specific content types.

** Heading Search

Search specifically in headings, with optional filtering:

*** Command
`Scimax: Search Headings' (`scimax.db.searchHeadings')

*** Features
- Search by heading text
- Filter by TODO state
- Filter by tag
- Shows heading level, tags, TODO state
- Displays deadlines and scheduled dates

*** Example Use Cases
#+BEGIN_SRC org
# Find all headings about Python
python

# Find TODOs with specific tag (use Tag Search)
:work:

# Browse document structure
<empty query>
#+END_SRC

** Tag Search

Search headings by org-mode tags:

*** Command
`Scimax: Search By Tag' (`scimax.db.searchByTag')

*** Features
- Lists all tags found in indexed files
- Shows heading count per tag
- Supports both direct and inherited tags
- Tags displayed as `:tagname:'

** Property Search

Search headings by property drawer values:

*** Command
`Scimax: Search By Property' (`scimax.db.searchByProperty')

*** Common Properties
#+BEGIN_SRC org
CUSTOM_ID    # Unique identifiers for linking
ID           # Auto-generated UUIDs
CATEGORY     # Classification
CREATED      # Creation timestamp
MODIFIED     # Last modification time
#+END_SRC

*** Examples
#+BEGIN_SRC org
# Find all entries with CATEGORY property
Property: CATEGORY
Value: <empty>

# Find entries with specific CATEGORY
Property: CATEGORY
Value: research

# Find entries with CUSTOM_ID
Property: CUSTOM_ID
Value: <empty or specific>
#+END_SRC

** TODO Search

Browse and filter TODO items:

*** Command
`Scimax: Show TODOs' (`scimax.db.showTodos')

*** Features
- Lists all TODO items across workspace
- Filter by state (TODO, DONE, IN-PROGRESS, etc.)
- Shows priority, tags, scheduling
- Excludes DONE and CANCELLED by default in other views

*** Common TODO States
#+BEGIN_SRC org
TODO          # Not started
IN-PROGRESS   # Currently working on
NEXT          # Up next
WAIT          # Waiting on something
DONE          # Completed
CANCELLED     # Abandoned
#+END_SRC

** ‚úÖ Source Block Search
CLOSED: [2026-01-17 Sat 12:03]

Search code blocks by language:

*** ‚úÖ Command
CLOSED: [2026-01-17 Sat 12:03]

  `Scimax: Search Code Blocks' (`scimax.db.searchBlocks'). [[cmd:scimax.db.searchBlocks]]

*** ‚úÖ Features
CLOSED: [2026-01-17 Sat 12:03]

- Filter by programming language
- Optional text search within code
- Shows first line of code as preview
- Includes both org files and notebook cells

*** ‚úÖ Example Workflow
CLOSED: [2026-01-17 Sat 12:03]
#+BEGIN_SRC org
1. Select language (or "All languages")
2. Optionally enter search text
3. Browse matching code blocks
4. Jump to file location
#+END_SRC

** ‚úÖ Hashtag Search
CLOSED: [2026-01-17 Sat 12:03]

Find files by inline hashtags:

*** ‚úÖ Command
CLOSED: [2026-01-17 Sat 12:04]

  `Scimax: Search Hashtags' (`scimax.db.searchHashtags'). [[cmd:scimax.db.searchHashtags]]

*** ‚úÖ Features
CLOSED: [2026-01-17 Sat 12:04]
- Lists all hashtags found (`#tagname')
- Shows file count per hashtag
- Displays files containing selected hashtag
- Case-insensitive matching

*** ‚úÖ Hashtag Format
CLOSED: [2026-01-17 Sat 12:04]

#+BEGIN_SRC org
# In your documents
This is a #research note about #machinelearning

# Database indexes as
research
machinelearning
#+END_SRC

** ‚úÖ File Browser
CLOSED: [2026-01-17 Sat 12:04]

Browse all indexed files:

*** ‚úÖ Command
CLOSED: [2026-01-17 Sat 12:04]

`Scimax: Browse Indexed Files' (`scimax.db.browseFiles'). [[cmd:scimax.db.browseFiles]]

*** ‚úÖ Features
CLOSED: [2026-01-17 Sat 12:04]

- Lists all files in database
- Shows last indexed date
- Sorted by most recently indexed
- Displays file type (org, md, ipynb)

* ‚úÖ Agenda and Time Management
CLOSED: [2026-01-17 Sat 12:04]

** ‚úÖ Agenda View
CLOSED: [2026-01-17 Sat 12:04]

The agenda shows scheduled items and deadlines:

*** ‚úÖ Command
CLOSED: [2026-01-17 Sat 12:05]

`Scimax: Show Agenda' (`scimax.db.agenda'). [[cmd:scimax.db.agenda]]

*** ‚úÖ Time Periods
CLOSED: [2026-01-17 Sat 12:05]

- Next 2 weeks (default)
- Next month
- Next 3 months
- All items (no time limit)

*** ‚úÖ Options
CLOSED: [2026-01-17 Sat 12:05]

- Include unscheduled TODOs
- Filter by time range
- Sorted by urgency (overdue first)

*** ‚úÖ Item Types
CLOSED: [2026-01-17 Sat 12:05]

**** ‚úÖ Deadline
CLOSED: [2026-01-17 Sat 12:05]
Items with DEADLINE timestamps:
#+BEGIN_SRC org
,* TODO Submit report
DEADLINE: <2026-01-20 Mon>
#+END_SRC

**** ‚úÖ Scheduled
CLOSED: [2026-01-17 Sat 12:05]

Items with SCHEDULED timestamps:
#+BEGIN_SRC org
,* TODO Team meeting
SCHEDULED: <2026-01-15 Wed 14:00>
#+END_SRC

**** ‚úÖ Unscheduled TODOs
CLOSED: [2026-01-17 Sat 12:06]

  Items with TODO state but no scheduling

** ‚úÖ Deadline View
CLOSED: [2026-01-17 Sat 12:06]

Show only upcoming deadlines:

*** Command
`Scimax: Show Deadlines' (`scimax.db.deadlines'). [[cmd:scimax.db.deadlines]]

*** ‚úÖ Features
CLOSED: [2026-01-17 Sat 12:06]

- Next 2 weeks of deadlines
- Overdue items highlighted
- Shows days until deadline
- Excludes DONE and CANCELLED

*** Display Format  
#+BEGIN_SRC org
‚ö†Ô∏è  Overdue: Submit TPS Report (3 days ago)
üîî Today: Code Review
üîî Tomorrow: Documentation Update
üîî In 5 days: Project Demo
#+END_SRC

** Date Formats

*** Scheduling in Org Files
#+BEGIN_SRC org
# Simple date
SCHEDULED: <2026-01-20>

# Date with time
SCHEDULED: <2026-01-20 Mon 14:00>

# Date with time range
SCHEDULED: <2026-01-20 Mon 14:00-16:00>

# Deadline with warning period
DEADLINE: <2026-01-20 Mon -3d>

# Closed timestamp
CLOSED: [2026-01-13 Mon 10:30]
#+END_SRC

*** Relative Dates
#+BEGIN_SRC org
+2w    # 2 weeks from now
+1m    # 1 month from now
+3d    # 3 days from now
+1y    # 1 year from now
#+END_SRC

* Search Scope

Limit searches to specific directories:

** Commands
`Scimax: Set Search Scope' (`scimax.db.setScope')

** Scope Types

*** All Files (Default)
- Searches entire indexed database
- Includes all workspace folders
- Includes additional configured directories

*** Current Directory
- Limits to active file's directory
- Includes subdirectories
- Useful for project-focused searches

** Current Scope Indicator
The current scope is shown when setting scope:
#+BEGIN_SRC org
Search scope: all
Search scope: directory (my-project)
#+END_SRC

* Database Management

** Reindexing

*** Full Reindex
Command: `Scimax: Reindex Files' (`scimax.db.reindex'). [[cmd:scimax.db.reindex]]

- Scans all workspace folders
- Checks file modification times
- Only reindexes changed files
- Shows progress notification
- Reports statistics on completion

*** ‚úÖ Auto-Indexing
CLOSED: [2026-01-17 Sat 12:08]

#+BEGIN_SRC json
{
  "scimax.db.autoIndex": true
}
#+END_SRC

Warning: Disable for very large workspaces (>10,000 files) to prevent memory issues.

*** ‚úÖ Additional Directories
CLOSED: [2026-01-17 Sat 12:08]

#+BEGIN_SRC json
{
  "scimax.db.directories": [
    "/home/user/research",
    "/home/user/notes",
    "~/Documents/org"
  ]
}
#+END_SRC

** Optimization

*** ‚úÖ Command
CLOSED: [2026-01-17 Sat 12:08]

`Scimax: Optimize Database' (`scimax.db.optimize'). [[cmd:scimax.db.optimize]]

*** Operations
- Removes entries for deleted files
- Runs VACUUM to reclaim space
- Rebuilds indexes for performance
- Should be run periodically (monthly)

** Clearing Database

*** Command
`Scimax: Clear Database' (`scimax.db.clear')

*** Warning
This is destructive and requires confirmation:
- Removes all indexed data
- Clears embeddings
- Resets statistics
- Requires full reindex to restore

*** When to Clear
- Database corruption
- Major schema changes
- Troubleshooting issues
- Fresh start needed

** Statistics

*** Command
`Scimax: Show Database Stats' (`scimax.db.stats')

*** Information Displayed
#+BEGIN_SRC org
Scimax DB: 127 files (98 org, 23 md, 6 ipynb),
1,234 headings, 456 code blocks, 789 links.
Semantic search: Enabled (243 chunks).
Last indexed: 2026-01-13 14:30:00
#+END_SRC

*** Stats Include
- File count by type
- Heading count
- Code block count
- Link count
- Chunk count (for semantic search)
- Embedding status
- Last index timestamp

* Performance Considerations

** Indexing Performance

*** File Size
- Small files (<100KB): ~10-50ms
- Medium files (100KB-1MB): ~50-200ms
- Large files (>1MB): ~200ms-1s

*** Batch Indexing
- 100 small files: ~2-5 seconds
- 1,000 small files: ~20-60 seconds
- With embeddings: 2-5x slower

*** Optimization Tips
1. Use ignore patterns for large non-content directories
2. Disable auto-indexing for huge workspaces
3. Index incrementally (only changed files)
4. Run optimization monthly

** Search Performance

*** Full-Text Search (FTS5)
- Query time: 10-50ms (typical)
- Scales well to 10,000+ files
- BM25 scoring is highly optimized
- Results returned in rank order

*** Semantic Search
- Query time: 50-500ms depending on provider
- Local embeddings: slower but private
- Ollama: moderate speed
- OpenAI: fastest but requires network

*** Hybrid Search
- Query time: Combined FTS + vector time
- Typically 100-600ms
- Runs searches in parallel
- RRF fusion adds ~10ms

** Database Size

*** Typical Sizes
#+BEGIN_SRC org
100 files:      ~5-10 MB
1,000 files:    ~50-100 MB
10,000 files:   ~500 MB-1 GB
#+END_SRC

*** With Embeddings
#+BEGIN_SRC org
+50-100% size increase for chunks and vectors
384-dim embeddings: ~1.5 KB per chunk
768-dim embeddings: ~3 KB per chunk
1536-dim embeddings: ~6 KB per chunk
#+END_SRC

** Memory Usage

*** Indexing
- Base: ~50-100 MB
- Peak during large batch: ~200-500 MB
- Embedding generation: +100-300 MB

*** Searching
- FTS5: ~10-50 MB
- Vector search: ~50-200 MB (loads embeddings)
- Minimal memory footprint when idle

** Scaling Guidelines

*** Small Workspace (<100 files)
- Enable auto-indexing
- Use any embedding provider
- Full reindex in seconds

*** Medium Workspace (100-1,000 files)
- Enable auto-indexing
- Local or Ollama embeddings recommended
- Full reindex in under a minute

*** Large Workspace (1,000-10,000 files)
- Consider disabling auto-indexing
- Local embeddings may be slow
- Use Ollama or OpenAI for better performance
- Reindex incrementally

*** Very Large Workspace (>10,000 files)
- Disable auto-indexing (manual reindex)
- Use selective directory indexing
- Consider multiple smaller databases
- OpenAI embeddings recommended for speed

* Configuration Reference

** Database Settings

*** `scimax.db.directories'
Type: `string[]'
Default: `[]'

Additional directories to index beyond workspace folders.

#+BEGIN_SRC json
{
  "scimax.db.directories": [
    "/home/user/notes",
    "~/Documents/research"
  ]
}
#+END_SRC

*** `scimax.db.ignorePatterns'
Type: `string[]'
Default: `["**/node_modules/**", "**/.git/**", "**/dist/**", "**/build/**", "**/.ipynb_checkpoints/**"]'

Glob patterns for files to exclude from indexing.

#+BEGIN_SRC json
{
  "scimax.db.ignorePatterns": [
    "**/node_modules/**",
    "**/.git/**",
    "**/dist/**",
    "**/temp/**",
    "**/*.backup.org"
  ]
}
#+END_SRC

*** `scimax.db.autoIndex'
Type: `boolean'
Default: `false'

Automatically index workspace on activation. Disable for large workspaces.

#+BEGIN_SRC json
{
  "scimax.db.autoIndex": true
}
#+END_SRC

** Embedding Settings

*** `scimax.db.embeddingProvider'
Type: `enum'
Values: "none" | "local" | "ollama" | "openai"
Default: `"none"'

Embedding provider for semantic search.

#+BEGIN_SRC json
{
  "scimax.db.embeddingProvider": "local"
}
#+END_SRC

*** `scimax.db.localModel'
Type: `enum'
Values: "Xenova/all-MiniLM-L6-v2" | "Xenova/bge-small-en-v1.5" | "Xenova/gte-small"
Default: `"Xenova/all-MiniLM-L6-v2"'

Local embedding model (Transformers.js).

#+BEGIN_SRC json
{
  "scimax.db.localModel": "Xenova/all-MiniLM-L6-v2"
}
#+END_SRC

*** `scimax.db.ollamaUrl'
Type: `string'
Default: `"http://localhost:11434"'

Ollama server URL.

#+BEGIN_SRC json
{
  "scimax.db.ollamaUrl": "http://localhost:11434"
}
#+END_SRC

*** `scimax.db.ollamaModel'
Type: `string'
Default: `"nomic-embed-text"'

Ollama embedding model name.

#+BEGIN_SRC json
{
  "scimax.db.ollamaModel": "nomic-embed-text"
}
#+END_SRC

*** OpenAI API Key (Secure Storage)

The OpenAI API key is stored securely using VS Code's SecretStorage API, which uses your operating system's credential manager:

- *macOS*: Keychain
- *Windows*: Credential Manager
- *Linux*: libsecret (GNOME Keyring, KWallet)

To set or update your API key, use the interactive setup:
Scimax: Configure Embedding Service (`scimax.db.configureEmbeddings')

* Command Reference

** Search Commands

| Command                    | Description                  |
|----------------------------+------------------------------|
| scimax.db.search           | Full-text search (FTS5)      |
| scimax.db.searchSemantic   | Semantic search (vector)     |
| scimax.db.searchHybrid     | Hybrid search (FTS + vector) |
| scimax.db.searchHeadings   | Search headings              |
| scimax.db.searchByTag      | Search by org tag            |
| scimax.db.searchByProperty | Search by property value     |
| scimax.db.searchBlocks     | Search code blocks           |
| scimax.db.searchHashtags   | Search by hashtag            |

** View Commands

| Command               | Description             |
|-----------------------+-------------------------|
| scimax.db.showTodos   | Show TODO items         |
| scimax.db.agenda      | Show agenda             |
| scimax.db.deadlines   | Show upcoming deadlines |
| scimax.db.browseFiles | Browse indexed files    |

** Management Commands

| Command                       | Description                 |
|-------------------------------+-----------------------------|
| scimax.db.reindex             | Reindex all files           |
| scimax.db.optimize            | Optimize database           |
| scimax.db.clear               | Clear database              |
| scimax.db.stats               | Show database statistics    |
| scimax.db.setScope            | Set search scope            |
| scimax.db.configureEmbeddings | Configure embedding service |

* Troubleshooting

** Semantic Search Not Working

*** Problem
Semantic search returns no results, shows "unavailable", or displays an error.

*** First: Check Vector Search Support

Run `Scimax: Show Database Stats' (`scimax.db.stats') to see the semantic search status:

| Status Message                         | Meaning                                 |
|----------------------------------------+-----------------------------------------|
| Semantic search: Enabled (N chunks)    | Working, N chunks with embeddings       |
| Semantic search: Ready (no embeddings) | Supported, but no provider configured   |
| Semantic search: Unavailable (error)   | Vector search not supported by database |

*** Vector Search Unavailable

If you see "Semantic search: Unavailable", the libsql database doesn't support vector operations. This can happen if:

- The libsql version doesn't include vector support
- The vector index failed to create

*Workaround*: Use full-text search (`scimax.db.search') instead. FTS5 is always available and fast.

*** Embedding Provider Issues

If vector search is supported but not working:

1. Check embedding provider is configured: `scimax.db.embeddingProvider'
2. Test connection: Run `Scimax: Configure Embedding Service'
3. Ensure files are reindexed after configuring embeddings
4. Check console for errors (`Help: Toggle Developer Tools')

*** Local Provider Issues
- First use downloads model (~30MB), wait for completion
- Check extension cache directory has write permissions
- Try different model if one fails

*** Ollama Issues
- Ensure Ollama is running: `ollama serve'
- Pull model: `ollama pull nomic-embed-text'
- Check URL is correct in settings
- Test connection: `curl http://localhost:11434/api/embeddings'

*** OpenAI Issues
- Verify API key is valid
- Check API quota and billing
- Ensure internet connection is stable

** Search Returns No Results

*** Problem
Searches return empty results despite having files.

*** Solutions
1. Run `Scimax: Show Database Stats' to check file count
2. If files ` 0, run 'Scimax: Reindex Files
3. Check file extensions (.org, .md, .ipynb)
4. Verify files aren't in ignored directories
5. Check search scope is set to "All files"

** Slow Indexing

*** Problem
Indexing takes very long or appears stuck.

*** Solutions
1. Check workspace size (number of files)
2. Add ignore patterns for large non-content directories
3. Disable embedding generation if not needed
4. Index directories incrementally
5. Check disk I/O and available memory

** Database Corruption

*** Problem
Errors mentioning "database is locked" or "disk I/O error".

*** Solutions
1. Close other VS Code windows accessing same workspace
2. Restart VS Code
3. Run `Scimax: Clear Database' and reindex
4. Check disk space is available
5. Verify database file permissions

** High Memory Usage

*** Problem
VS Code uses excessive memory during indexing or searching.

*** Solutions
1. Disable auto-indexing
2. Reduce number of indexed directories
3. Use more aggressive ignore patterns
4. Clear and reindex database
5. Restart VS Code between large indexing operations

* Examples and Workflows

** Research Paper Management

#+BEGIN_SRC org
# Organize papers with properties
,* TODO Read: Attention Is All You Need
:PROPERTIES:
:CUSTOM_ID: vaswani2017attention
:AUTHOR: Vaswani et al.
:YEAR: 2017
:CATEGORY: research
:END:

#transformers #attention #nlp

SCHEDULED: <2026-01-15 Wed>

# Search by property
Property: CATEGORY
Value: research

# Search by hashtag
#nlp

# Semantic search
transformer architecture papers
#+END_SRC

** Project Todo Management

#+BEGIN_SRC org
# Use tags for organization
,* TODO Implement login feature :work:backend:
DEADLINE: <2026-01-20 Mon>

,* TODO Write API documentation :work:docs:
SCHEDULED: <2026-01-18 Sat>

# Search by tag
:work: -> shows all work items
:backend: -> shows backend tasks

# View agenda
Next 2 weeks -> prioritized by deadline

# Search TODOs
Filter by: TODO (in progress)
#+END_SRC

** Code Snippet Library

#+BEGIN_SRC org
# Store reusable code blocks
,* Data Processing Utils

,#+BEGIN_SRC python
def normalize_data(df):
    """Normalize numeric columns"""
    return (df - df.mean()) / df.std()
,#+END_SRC

# Search code blocks
Language: python
Query: normalize

# Or semantic search
how to standardize dataframe columns
#+END_SRC

** Personal Knowledge Base

#+BEGIN_SRC org
# Use hybrid search for discovery
Query: "improve code performance"

Results will include:
- Exact matches: "code performance" articles
- Related concepts: optimization, profiling, caching
- Similar topics: algorithm efficiency, memory management

# Use properties for metadata
:PROPERTIES:
:CREATED: [2026-01-13 Mon 10:00]
:MODIFIED: [2026-01-13 Mon 15:30]
:CATEGORY: programming
:END:
#+END_SRC

* Best Practices

** Indexing Strategy

1. *Start selective* - Index specific directories first
2. *Use ignore patterns* - Exclude build artifacts and dependencies
3. *Index incrementally* - Don't reindex everything on changes
4. *Schedule optimization* - Run monthly for large databases
5. *Monitor statistics* - Check file counts and sizes regularly

** Search Strategy

1. *Start broad* - Use semantic or hybrid search for exploration
2. *Refine with keywords* - Switch to FTS for specific terms
3. *Use structured queries* - Filter by tags/properties when possible
4. *Set scope appropriately* - Narrow to directories for focused work
5. *Combine approaches* - Use multiple search types for thorough research

** Organization Tips

1. *Use consistent tags* - Establish tag naming conventions
2. *Add properties* - Include metadata for filtering
3. *Set schedules* - Use SCHEDULED/DEADLINE for time management
4. *Include hashtags* - Quick inline categorization
5. *Write descriptive headings* - Better search results

** Performance Tips

1. *Disable auto-indexing* - For large workspaces (manual trigger)
2. *Choose appropriate embeddings* - Balance quality vs. speed
3. *Limit result counts* - Don't request thousands of results
4. *Use search scope* - Narrow searches to relevant directories
5. *Cache frequent queries* - Database has 15-minute result cache

* Technical Architecture

** Database Schema

*** Files Table
Tracks indexed files with modification tracking:
- `path', `file_type', `mtime', `hash', `size', `indexed_at'

*** Headings Table
Org/markdown headings with full metadata:
- `level', `title', `todo_state', `priority'
- `tags', `inherited_tags', `properties'
- `scheduled', `deadline', `closed'
- `line_number', `begin_pos'

*** Source Blocks Table
Code blocks with language and content:
- `language', `content', `headers'
- `line_number', `cell_index'

*** Links Table
All link types (file, http, id, etc.):
- `link_type', `target', `description'
- `line_number'

*** Hashtags Table
Inline hashtags:
- `tag', `file_path'

*** Chunks Table
Text chunks for semantic search:
- `content', `line_start', `line_end'
- `embedding' (F32_BLOB vector)

*** FTS Content (Virtual Table)
Full-text search index:
- `file_path', `title', `content'
- Porter stemming, Unicode normalization
- BM25 ranking support

** Indexes

Performance indexes on:
- `headings.file_id', `headings.todo_state'
- `headings.deadline', `headings.scheduled'
- `source_blocks.language'
- `hashtags.tag'
- `chunks.embedding' (vector index with cosine metric)
- `files.file_type'

** Vector Search

Using libsql's vector extension:
- Cosine similarity metric
- F32_BLOB storage format
- HNSW-like index structure
- Efficient nearest neighbor queries

** Parsers

*** Org Mode
`UnifiedParserAdapter' - Full AST parser compatible with org-element:
- Recursive heading parsing with inheritance
- Property drawer extraction
- Timestamp parsing (scheduled, deadline, closed)
- Source block with headers
- Link extraction

*** Markdown
Simplified parser:
- ATX heading syntax (`#')
- Fenced code blocks
- Inline links

*** Jupyter Notebooks
`ipynbParser' - Notebook-specific parser:
- Markdown cells ‚Üí headings and links
- Code cells ‚Üí source blocks
- Cell indices tracked for navigation
- Hashtags from markdown cells

* See Also

- [[file:01-getting-started.org][Getting Started]] - Initial setup and first steps
- [[file:07-source-blocks.org][Source Blocks]] - Code execution and literate programming
- [[file:03-todo-items.org][TODO Items]] - Task management features
- [[file:05-links.org][Links]] - Link types and navigation
- [[file:26-configuration.org][Configuration]] - Full settings reference

* Navigation

- Previous: [[file:17-projectile.org][Projectile]]
- Index: [[file:00-index.org][Documentation Index]]
- Next: [[file:19-references.org][References]]
