#+TITLE: Image Overlays
#+AUTHOR: Scimax VS Code Team
#+DATE: 2026-01-13
#+STARTUP: overview
#+OPTIONS: toc:2 num:t H:4
#+TODO: âš ï¸ ðŸ‘€ | âœ…

*Keybinding Note:* This extension uses Emacs-style keybindings where Ctrl is used on all platforms (not Cmd on Mac), except where explicitly noted. Mac alternatives are shown as Cmd where applicable.

* âœ… Introduction
CLOSED: [2026-01-15 Thu 14:06]

Image overlays provide inline image display functionality in org-mode files, similar to Emacs org-mode's image display feature. When enabled, image links are rendered as thumbnails directly in the editor, allowing you to preview images without opening them separately.

This feature enhances the visual experience of working with org documents that contain images, such as:

- Scientific notebooks with plots and diagrams
- Documentation with screenshots and illustrations
- Journal entries with photos
- Results from source block executions (especially Jupyter)

** âœ… How Image Overlays Work
CLOSED: [2026-01-15 Thu 14:07]

Due to VS Code's limitations compared to Emacs overlays, the extension uses *Hover Previews* - Full-size image preview when hovering over image links

Thumbnails are automatically generated and cached for performance, using ImageMagick or native macOS tools when available.

* âœ… Supported Image Formats
CLOSED: [2026-01-15 Thu 14:07]

The image overlay system supports the following image formats:

| Format | Extension(s)      | Notes                           |
|--------+-------------------+---------------------------------|
| PNG    | .png              | Fully supported                 |
| JPEG   | .jpg, .jpeg       | Fully supported                 |
| GIF    | .gif              | Fully supported (static frames) |
| SVG    | .svg              | Scalable vector graphics        |
| WebP   | .webp             | Modern web format               |
| BMP    | .bmp              | Bitmap images                   |
| TIFF   | .tiff, .tif       | Tagged image format             |
| ICO    | .ico              | Icon files                      |

* âœ… Image Link Syntax
CLOSED: [2026-01-15 Thu 14:07]

** âœ… Basic Image Links
CLOSED: [2026-01-15 Thu 14:07]

The simplest way to include an image is with a basic link:

#+BEGIN_SRC org
[[./_static/logo.svg]]
#+END_SRC

This displays the image inline and can be clicked to open.

** âœ… File Protocol Links
CLOSED: [2026-01-15 Thu 14:08]

You can explicitly use the file: protocol:

#+BEGIN_SRC org
[[file:./_static/logo.svg]]
#+END_SRC

Both formats work identically - the file: prefix is optional for local files.

** âœ… Links with Descriptions
CLOSED: [2026-01-17 Sat 09:33]

Add descriptive text that appears as a clickable link:

#+BEGIN_SRC org
[[./_static/logo.svg][My beautiful diagram]]
[[file:./_static/logo.svg][Demo Screenshot]]
#+END_SRC

The description text is shown in the editor, while the image overlay appears in the gutter or inline.

** âœ… Absolute vs Relative Paths
CLOSED: [2026-01-17 Sat 09:49]

Both absolute and relative paths are supported:

#+BEGIN_SRC org
# Relative to current file
[[./_static/logo.svg]]


# Absolute paths
[[file:/Users/jkitchin/Dropbox/projects/scimax_vscode/docs/_static/logo.svg]]
[[file:~/Dropbox/projects/scimax_vscode/docs/_static/logo.svg]]
#+END_SRC

The ~ (tilde) is expanded to the home directory on Unix-like systems.

** âœ… Remote Images
CLOSED: [2026-01-17 Sat 09:52]

Remote image URLs are *not* displayed as overlays but are still valid links:

[[https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png]]

These links work for navigation but won't show thumbnails in the editor.

* âœ… Image Sizing and Attributes
CLOSED: [2026-01-17 Sat 09:39]

** âœ… ATTR_ORG Keyword

Control how images are displayed using the #+ATTR_ORG: keyword above the image link:

#+BEGIN_SRC org
#+ATTR_ORG: :width 400
[[_static/logo.svg]]
#+END_SRC

*Note:* Currently, the #+ATTR_ORG: keyword is parsed but the :width and :height attributes primarily affect *export* output rather than the overlay display size. The overlay thumbnail size is controlled by the [[*Configuration Settings][configuration settings]].

** âœ… Supported Attributes
CLOSED: [2026-01-17 Sat 09:40]

| Attribute | Purpose                      | Example              |
|-----------+------------------------------+----------------------|
| :width    | Image width (export)         | :width 400           |
| :height   | Image height (export)        | :height 300          |
| :scale    | Scale factor (export)        | :scale 0.5           |
| :align    | Alignment (export)           | :align center        |
| :alt      | Alt text (export)            | :alt "Description"   |

** âœ… Export-Specific Attributes
CLOSED: [2026-01-17 Sat 09:40]

For LaTeX and HTML export, use backend-specific attributes:


#+ATTR_LATEX: :width 0.8\textwidth :placement [htbp]
#+ATTR_HTML: :width 600px :class figure
[[file:./_static/logo.svg]]


See [[file:10-export.org][Export Documentation]] for more details on export attributes.

** âœ… Adding Captions
CLOSED: [2026-01-17 Sat 19:52]

Add captions that appear in exports:

#+NAME: fig:logo
#+CAPTION: System Architecture Diagram
[[file:./_static/logo.svg]]


* âœ… Enabling and Disabling Image Display
CLOSED: [2026-01-17 Sat 09:54]

** âœ… Global Toggle
CLOSED: [2026-01-17 Sat 09:54]

Toggle image overlays for all org files:

- *Command:* Scimax: Toggle Image Overlays
- *Command ID:* [[cmd:scimax.imageOverlays.toggle]]


** âœ… Per-File Toggle
CLOSED: [2026-01-17 Sat 09:54]

Toggle image overlays for the current file only:

- *Command:* Scimax: Toggle Image Overlays for Current File
- *Command ID:* scimax.imageOverlays.toggleCurrentFile

This is useful when you want overlays disabled for one specific large document but enabled globally.

** âœ… Via Configuration
CLOSED: [2026-01-17 Sat 09:54]

Permanently enable or disable in your settings.json:

#+BEGIN_SRC json
{
  "scimax.imageOverlays.enabled": true
}
#+END_SRC

Set to false to disable by default.

* âœ… Configuration Settings
CLOSED: [2026-01-17 Sat 09:54]

** âœ… scimax.imageOverlays.enabled
CLOSED: [2026-01-17 Sat 09:31]

*Type:* boolean
*Default:* true

Enable or disable inline image thumbnails globally.

#+BEGIN_SRC json
{
  "scimax.imageOverlays.enabled": true
}
#+END_SRC

** âœ… scimax.imageOverlays.maxWidth
CLOSED: [2026-01-17 Sat 09:31]

*Type:* number
*Default:* 96

Maximum width in pixels for thumbnail icons. Thumbnails are scaled down to fit within these dimensions while maintaining aspect ratio.

#+BEGIN_SRC json
{
  "scimax.imageOverlays.maxWidth": 128
}
#+END_SRC

** âœ… scimax.imageOverlays.maxHeight
CLOSED: [2026-01-17 Sat 09:31]

*Type:* number
*Default:* 96

Maximum height in pixels for thumbnail icons.

#+BEGIN_SRC json
{
  "scimax.imageOverlays.maxHeight": 128
}
#+END_SRC

** âœ… scimax.imageOverlays.renderMode
CLOSED: [2026-01-17 Sat 09:31]

*Type:* string (enum)
*Default:* "gutter"
*Options:* gutter, after, both

Controls where image thumbnails are displayed:

- gutter - Show thumbnail in the editor gutter (line margin) - *recommended*
- after - Show emoji and dimensions inline after the link text
- both - Show both gutter thumbnail and inline decoration

#+BEGIN_SRC json
{
  "scimax.imageOverlays.renderMode": "gutter"
}
#+END_SRC

*Recommendations:*
- Use gutter for a clean, unobtrusive experience
- Use after if you prefer inline indicators
- Use both for maximum visibility

** âœ… scimax.imageOverlays.onlyWhenCursorNotInLink
CLOSED: [2026-01-17 Sat 10:01]

*Type:* boolean
*Default:* true

Hide the overlay when your cursor is inside the image link. This prevents the thumbnail from obscuring the link text you're editing.

#+BEGIN_SRC json
{
  "scimax.imageOverlays.onlyWhenCursorNotInLink": true
}
#+END_SRC

Set to false to always show overlays, even when editing.

** âœ… scimax.imageOverlays.excludePatterns
CLOSED: [2026-01-17 Sat 10:01]

*Type:* array of strings
*Default:* [ ]

Regex patterns for image paths to exclude from overlay display. Useful for hiding certain directories or file patterns.

#+BEGIN_SRC json
{
  "scimax.imageOverlays.excludePatterns": [
    "\\.tmp/",
    "/archive/",
    "draft-.*\\.png"
  ]
}
#+END_SRC

Examples:
- "\\.tmp/" - Exclude images in .tmp directories
- "^http" - Exclude remote URLs (already excluded by default)
- "screenshot-.*" - Exclude files starting with "screenshot-"

** âœ… scimax.imageOverlays.maxOverlaysPerDocument
CLOSED: [2026-01-17 Sat 10:02]

*Type:* number
*Default:* 200

Maximum number of image overlays to display per document. This prevents performance issues in documents with hundreds of images.

#+BEGIN_SRC json
{
  "scimax.imageOverlays.maxOverlaysPerDocument": 500
}
#+END_SRC

If your document exceeds this limit, you'll see a warning message.

** âœ… scimax.imageOverlays.showDimensions
CLOSED: [2026-01-17 Sat 10:02]

*Type:* boolean
*Default:* true

When using after or both render modes, show image dimensions (e.g., "800x600") in the inline decoration.

#+BEGIN_SRC json
{
  "scimax.imageOverlays.showDimensions": true
}
#+END_SRC

** âœ… scimax.imageOverlays.cacheEnabled
CLOSED: [2026-01-17 Sat 10:02]

*Type:* boolean
*Default:* true

Enable thumbnail caching for faster loading. Thumbnails are stored in the extension's global storage directory.

#+BEGIN_SRC json
{
  "scimax.imageOverlays.cacheEnabled": true
}
#+END_SRC

Set to false to disable caching (may impact performance).

* âœ… Images from Source Block Results
CLOSED: [2026-01-17 Sat 10:02]

** âœ… Jupyter Kernel Output
CLOSED: [2026-01-17 Sat 10:05]

Jupyter kernels automatically save image output to the .ob-jupyter/ directory:


#+BEGIN_SRC jupyter-python :session py
import matplotlib.pyplot as plt
import numpy as np

plt.plot([1, 2, 3, 4], [1, 4, 9, 16])
plt.show()
#+END_SRC

#+RESULTS:
[[file:.ob-jupyter/output-1768662289804-0.png]]


These images are automatically displayed as overlays when image overlays are enabled.

See [[file:09-jupyter.org][Jupyter Documentation]] for more details on Jupyter integration.

* âœ… Available Commands
CLOSED: [2026-01-17 Sat 12:42]

** âœ… Scimax: Toggle Image Overlays
CLOSED: [2026-01-17 Sat 12:42]

*Command ID:* [[cmd:scimax.imageOverlays.toggle]]

Toggle image overlays globally for all org files. When disabled, no thumbnails are shown but links remain functional.

** âœ… Scimax: Toggle Image Overlays for Current File
CLOSED: [2026-01-17 Sat 12:42]

*Command ID:* [[cmd:scimax.imageOverlays.toggleCurrentFile]]

Toggle image overlays for the currently active org file only. Useful for temporarily hiding overlays in specific documents.

** âœ… Scimax: Refresh Image Overlays
CLOSED: [2026-01-17 Sat 09:51]

*Command ID:* [[cmd:scimax.imageOverlays.refresh]]

Manually refresh all image overlays in visible editors. This can be useful if:
- You've modified image files externally
- Overlays aren't updating correctly
- You've changed configuration settings

** âœ… Scimax: Clear Image Overlay Cache
CLOSED: [2026-01-17 Sat 09:51]

*Command ID:* [[cmd:scimax.imageOverlays.clearCache]]

Clear the thumbnail cache. This will:
- Delete all cached thumbnails
- Free up disk space
- Force thumbnails to be regenerated on next display

Useful if thumbnails are corrupted or you want to reclaim space.

** âœ… Scimax: Show Image Overlay Cache Statistics
CLOSED: [2026-01-17 Sat 09:50]

*Command ID:* [[cmd:scimax.imageOverlays.showStats]]

Display information about the thumbnail cache:
- Number of cached thumbnails
- Total cache size in KB

Useful for monitoring cache usage.

* âœ… Troubleshooting Image Display
CLOSED: [2026-01-17 Sat 09:51]

** âœ… Images Not Showing
CLOSED: [2026-01-17 Sat 09:51]

If image overlays aren't displaying:

1. *Check if overlays are enabled:*
   - Run command: Scimax: Toggle Image Overlays
   - Check setting: scimax.imageOverlays.enabled

2. *Verify the image file exists:*
   - Hover over the link to see the full path
   - Check for "Image not found" warning in the hover tooltip
   - Verify file permissions

3. *Check the file extension:*
   - Ensure the file has a supported image extension
   - Extensions are case-insensitive (.PNG works like .png)

4. *Try refreshing:*
   - Run command: Scimax: Refresh Image Overlays

5. *Check exclude patterns:*
   - Review scimax.imageOverlays.excludePatterns setting
   - Ensure your image path doesn't match an exclude pattern

** âœ… Overlays Disappear When Editing
CLOSED: [2026-01-17 Sat 09:51]

This is *normal behavior* when scimax.imageOverlays.onlyWhenCursorNotInLink is true (default). The overlay hides when your cursor is inside the link to prevent obscuring the text you're editing.

To always show overlays:

#+BEGIN_SRC json
{
  "scimax.imageOverlays.onlyWhenCursorNotInLink": false
}
#+END_SRC

** âœ… Performance Issues
CLOSED: [2026-01-17 Sat 09:51]

If you experience slow performance:

1. *Reduce the overlay limit:*
   #+BEGIN_SRC json
   {
     "scimax.imageOverlays.maxOverlaysPerDocument": 100
   }
   #+END_SRC

2. *Reduce thumbnail size:*
   #+BEGIN_SRC json
   {
     "scimax.imageOverlays.maxWidth": 64,
     "scimax.imageOverlays.maxHeight": 64
   }
   #+END_SRC

3. *Use gutter mode only:*
   #+BEGIN_SRC json
   {
     "scimax.imageOverlays.renderMode": "gutter"
   }
   #+END_SRC

4. *Disable overlays for specific files:*
   - Use command: Scimax: Toggle Image Overlays for Current File

** âœ… Thumbnails Are Blurry or Corrupted
CLOSED: [2026-01-17 Sat 09:51]

1. *Clear the cache:*
   - Run command: Scimax: Clear Image Overlay Cache

2. *Check if ImageMagick is installed:*
   - The extension uses ImageMagick (convert) or macOS sips for thumbnail generation
   - Install ImageMagick: brew install imagemagick (macOS) or apt install imagemagick (Linux)

3. *Verify the original image isn't corrupted:*
   - Open the image in an external viewer

** âœ… Relative Paths Not Resolving
CLOSED: [2026-01-17 Sat 12:43]

If relative paths aren't working:

1. *Use ./ prefix for clarity:*
   
   [[./_static/plot.png]]  # Better

   [[_static/plot.png]]    # Also works, but less clear


2. *Check your working directory:*
   - Paths are resolved relative to the org file's directory

3. *Use absolute paths as a workaround:*
  
   [[file:/Users/jkitchin/Dropbox/projects/scimax_vscode/docs/_static/plot.png]]
 

** âœ… Hover Preview Not Working
CLOSED: [2026-01-17 Sat 12:43]

If hover previews aren't showing:

1. *Check hover delay:*
   - VS Code has a built-in hover delay setting
   - Try hovering for longer

2. *Verify hover provider is active:*
   - Hover should work for all org links, not just images
   - If no hovers work at all, check VS Code's language server settings

3. *Try a different image format:*
   - Some formats may not preview well
   - SVG and PNG typically work best

* âœ… Example Configuration
CLOSED: [2026-01-17 Sat 12:43]

** âœ… Minimal Configuration
CLOSED: [2026-01-17 Sat 12:44]

For basic image overlay functionality:

#+BEGIN_SRC json
{
  "scimax.imageOverlays.enabled": true,
  "scimax.imageOverlays.renderMode": "gutter"
}
#+END_SRC

** âœ… Power User Configuration
CLOSED: [2026-01-17 Sat 12:44]

For maximum visual feedback:

#+BEGIN_SRC json
{
  "scimax.imageOverlays.enabled": true,
  "scimax.imageOverlays.maxWidth": 128,
  "scimax.imageOverlays.maxHeight": 128,
  "scimax.imageOverlays.renderMode": "both",
  "scimax.imageOverlays.onlyWhenCursorNotInLink": true,
  "scimax.imageOverlays.showDimensions": true,
  "scimax.imageOverlays.maxOverlaysPerDocument": 500,
  "scimax.imageOverlays.cacheEnabled": true
}
#+END_SRC

** âœ… Performance-Focused Configuration
CLOSED: [2026-01-17 Sat 12:44]

For large documents with many images:

#+BEGIN_SRC json
{
  "scimax.imageOverlays.enabled": true,
  "scimax.imageOverlays.maxWidth": 64,
  "scimax.imageOverlays.maxHeight": 64,
  "scimax.imageOverlays.renderMode": "gutter",
  "scimax.imageOverlays.onlyWhenCursorNotInLink": true,
  "scimax.imageOverlays.showDimensions": false,
  "scimax.imageOverlays.maxOverlaysPerDocument": 100,
  "scimax.imageOverlays.cacheEnabled": true,
  "scimax.imageOverlays.excludePatterns": ["archive/", "\\.tmp/"]
}
#+END_SRC

* âœ… Complete Example
CLOSED: [2026-01-17 Sat 12:44]

Here's a complete example showing various image link formats:

#+BEGIN_SRC org
,* My Research Notes

,** Experimental Results

The experiment produced the following results:

,#+CAPTION: Sine wave plot
,#+NAME: fig:sine
,#+ATTR_ORG: :width 400
[[file:./plots/sine-wave.png]]

As shown in Figure [[fig:sine]], the sine wave exhibits periodic behavior.

,** Data Visualization

,#+BEGIN_SRC jupyter-python :session analysis
import matplotlib.pyplot as plt
import numpy as np

x = np.linspace(0, 2*np.pi, 100)
y = np.sin(x)

plt.figure(figsize=(10, 6))
plt.plot(x, y)
plt.title('Sine Wave')
plt.xlabel('x')
plt.ylabel('sin(x)')
plt.grid(True)
plt.show()
,#+END_SRC

,#+RESULTS:
[[file:.ob-jupyter/output-1705171200000-0.png]]

,** Screenshots

Here are some screenshots from the application:

[[./screenshots/main-window.png][Main Window]]
[[./screenshots/settings-dialog.png][Settings Dialog]]
[[./screenshots/export-preview.png][Export Preview]]

,** External Resources

Note: Remote images don't show overlays but are clickable:

[[https://example.com/logo.png][Company Logo]]
#+END_SRC

* âœ… Inserting Screenshots
CLOSED: [2026-01-24 Sat 17:37]

The extension provides a cross-platform screenshot command that captures a screen region and inserts a link to the saved image.

** âœ… Taking a Screenshot
CLOSED: [2026-01-24 Sat 17:37]

Press =F10= in an org or markdown file to take a screenshot:

1. Press =F10= - the screen capture tool activates
2. Select the area you want to capture (or press Escape to cancel)
3. The screenshot is saved to a =screenshots/= directory next to your file
4. An image link is automatically inserted at the cursor position

| Platform | Tool Used                                                 |
|----------+-----------------------------------------------------------|
| macOS    | =screencapture= (built-in)                                |
| Windows  | SnippingTool via PowerShell                               |
| Linux    | Auto-detects: gnome-screenshot, scrot, flameshot, or maim |

** âœ… macOS Permission Setup
CLOSED: [2026-01-24 Sat 17:37]

The first time you use the screenshot command on macOS, you may need to grant screen recording permission to VS Code:

1. Press =F10= to trigger the screenshot
2. macOS will show a permission dialog or the capture will fail silently
3. Go to *System Settings > Privacy & Security > Screen Recording*
4. Enable the checkbox for *Visual Studio Code*
5. *Restart VS Code* for the permission to take effect
6. Try =F10= again

** âœ… Inserted Link Format
CLOSED: [2026-01-24 Sat 17:37]

For org-mode files, the inserted link includes a width attribute:

#+BEGIN_SRC org
#+attr_org: :width 800
[[./screenshots/screenshot-2026-01-23-14-30-45.png]]
#+END_SRC

For markdown files:

#+BEGIN_SRC markdown
![screenshot](./screenshots/screenshot-2026-01-23-14-30-45.png)
#+END_SRC

The width is automatically determined from the image dimensions (capped at 800 pixels).

** âœ… Screenshot Directory
CLOSED: [2026-01-24 Sat 17:37]

Screenshots are saved to a =screenshots/= subdirectory relative to the current file. The directory is created automatically if it doesn't exist.

Filenames follow the pattern: =screenshot-YYYY-MM-DD-HH-MM-SS.png=

** âœ… Linux Screenshot Tools
CLOSED: [2026-01-24 Sat 17:37]

On Linux, the extension tries these tools in order and uses the first one found:

1. =gnome-screenshot -a= (GNOME desktop)
2. =scrot -s= (lightweight, widely available)
3. =flameshot gui= (feature-rich, popular choice)
4. =maim -s= (modern alternative to scrot)
5. =import= (ImageMagick, works everywhere)

Install at least one of these tools for screenshot functionality.

** âœ… Command Reference
CLOSED: [2026-01-24 Sat 17:37]

| Command                 | Keybinding | Description                           |
|-------------------------+------------+---------------------------------------|
| scimax.insertScreenshot | F10        | Capture screen region and insert link |

* âœ… See Also

- [[file:05-links.org][Links]] - General link syntax and functionality
- [[file:07-source-blocks.org][Source Blocks]] - Executing code that generates images
- [[file:09-jupyter.org][Jupyter Integration]] - Working with Jupyter kernels
- [[file:10-export.org][Export]] - Exporting documents with images
- [[file:26-configuration.org][Configuration]] - Full configuration reference

* âœ… Technical Details

** âœ… Thumbnail Generation

Thumbnails are generated using:

1. *ImageMagick* (convert command) - Preferred, works on all platforms
2. *macOS sips* - Native macOS tool, used as fallback on Mac
3. *Direct copy* - If no tools available, original images are used

Thumbnails are cached in the extension's global storage directory with filenames based on:
- MD5 hash of the original image path
- Configured thumbnail dimensions
- Original file extension

** âœ… Cache Location

Thumbnails are stored in:

- *Linux:* ~/.config/Code/User/globalStorage/scimax-vscode/image-overlay-cache/
- *macOS:* ~/Library/Application Support/Code/User/globalStorage/scimax-vscode/image-overlay-cache/
- *Windows:* %APPDATA%\Code\User\globalStorage\scimax-vscode\image-overlay-cache\

** âœ… Performance Considerations

- Thumbnail generation is asynchronous and doesn't block the editor
- The cache prevents regenerating thumbnails on each file open
- The maxOverlaysPerDocument setting prevents memory issues with large documents
- Overlays are debounced during typing to avoid excessive updates
- Gutter mode is more performant than after/both modes

** âœ… VS Code Limitations

Unlike Emacs, VS Code cannot:
- Display arbitrary-sized inline images in the editor
- Replace link text with actual image content
- Provide true "overlay" functionality at the text level

The implementation uses VS Code's decoration API with gutter icons as the closest approximation to Emacs overlays.

* Navigation

- Previous: [[file:11-latex-preview.org][LaTeX Preview]]
- Index: [[file:00-index.org][Documentation Index]]
- Next: [[file:13-agenda.org][Agenda]]
