#+TITLE: LaTeX Manuscript Flattening
#+AUTHOR: Scimax VS Code
#+OPTIONS: toc:2 num:t
#+TODO: ‚ö†Ô∏è üëÄ | ‚úÖ

* ‚úÖ Overview
CLOSED: [2026-01-21 Wed 07:07]

When writing academic papers in LaTeX, e.g. with Overleaf, it is common to organize figures into a separate directory, and sometimes to include files in directories to keep the main directory well-organized. Some publishers do not like this, however, and it is extremely annoying to have to manually copy all the files into a single directory with simple names, inline the bibliography, and flatten all the =\input= and =\include= commands into a single =.tex= file.

The manuscript module helps prepare LaTeX documents for journal submission by creating a self-contained, flattened version of your manuscript.

When submitting papers to journals, you often need:
- A single =.tex= file (no =\input= or =\include= commands)
- Bibliography inlined from the =.bbl= file
- All figures in the same directory with simple names
- Local style files (=.sty=, =.cls=, =.bst=) included

This module automates that process while preserving your original files.

* ‚úÖ Commands
CLOSED: [2026-01-21 Wed 07:07]

** ‚úÖ Flatten Manuscript
CLOSED: [2026-01-21 Wed 07:07]

Command: =scimax.manuscript.flatten=

Opens from Command Palette: "Scimax: Flatten Manuscript for Submission"

This is the main command that:
1. Optionally compiles your document to generate/update the =.bbl= file
2. Flattens all =\input{}= and =\include{}= commands
3. Inlines the bibliography (=.bbl= content)
4. Renames figures sequentially (=1.pdf=, =2.png=, etc.)
5. Detects and copies local support files (=.sty=, =.cls=, =.bst=, data files)
6. Creates a timestamped submission directory

** ‚úÖ Preview Flattening

Command: =scimax.manuscript.preview=

Opens from Command Palette: "Scimax: Preview Manuscript Flattening"

Shows what would happen without making changes:
- Number of included files
- Number of figures to rename
- Support files to copy (=.sty=, =.cls=, =.bst=, data files)
- Whether compilation is needed
- Any warnings

** ‚úÖ Flatten to Directory
CLOSED: [2026-01-21 Wed 07:07]

Command: =scimax.manuscript.flattenToDirectory=

Opens from Command Palette: "Scimax: Flatten Manuscript to Directory"

Same as flatten, but lets you choose the output directory.

* ‚úÖ Output Structure
CLOSED: [2026-01-21 Wed 07:08]

Given a project structure like:

#+begin_example
paper/
‚îú‚îÄ‚îÄ main.tex
‚îú‚îÄ‚îÄ sections/
‚îÇ   ‚îú‚îÄ‚îÄ intro.tex
‚îÇ   ‚îî‚îÄ‚îÄ methods.tex
‚îú‚îÄ‚îÄ figures/
‚îÇ   ‚îú‚îÄ‚îÄ plot1.pdf
‚îÇ   ‚îî‚îÄ‚îÄ results.png
‚îú‚îÄ‚îÄ refs.bib
‚îî‚îÄ‚îÄ main.bbl
#+end_example

After flattening, you get:

#+begin_example
paper/
‚îú‚îÄ‚îÄ submission-2026-01-20/
‚îÇ   ‚îú‚îÄ‚îÄ main.tex      # Flattened, all paths updated
‚îÇ   ‚îú‚îÄ‚îÄ 1.pdf         # was figures/plot1.pdf
‚îÇ   ‚îî‚îÄ‚îÄ 2.png         # was figures/results.png
‚îî‚îÄ‚îÄ (original files unchanged)
#+end_example

* ‚úÖ Figure Naming
CLOSED: [2026-01-21 Wed 07:08]

Figures are renamed sequentially with smart padding based on the total count:

| Total Figures | Naming Pattern            |
|---------------+---------------------------|
| 1-9           | =1.pdf=, =2.png=, ...     |
| 10-99         | =01.pdf=, =02.png=, ...   |
| 100-999       | =001.pdf=, =002.png=, ... |

This ensures correct sorting in file managers.

* ‚úÖ Support Files
CLOSED: [2026-01-21 Wed 07:08]

The module automatically detects and copies local support files that your document needs:

** ‚úÖ Style Files (.sty)
CLOSED: [2026-01-21 Wed 07:08]

Custom LaTeX packages in your project directory. Detected from =\usepackage{...}= commands.

** ‚úÖ Class Files (.cls)
CLOSED: [2026-01-21 Wed 07:08]

Custom document classes. Detected from =\documentclass{...}=.

** ‚úÖ Bibliography Style Files (.bst)
CLOSED: [2026-01-21 Wed 07:08]

Custom bibliography styles. Detected from =\bibliographystyle{...}=.

Standard styles (plain, unsrt, alpha, IEEEtran, etc.) are not copied since they're available on most LaTeX installations.

** ‚úÖ Data Files
CLOSED: [2026-01-21 Wed 07:08]

Files used by packages like pgfplots:
- =\pgfplotstableread{data.csv}=
- =\DTLloaddb{name}{data.csv}=
- =\input{data.dat}=

* ‚úÖ Bibliography Handling
CLOSED: [2026-01-21 Wed 07:08]

The module supports both traditional BibTeX and biblatex:

** ‚úÖ BibTeX
CLOSED: [2026-01-21 Wed 07:08]

- Replaces =\bibliography{refs}= with the contents of =main.bbl=
- Keeps =\bibliographystyle{...}= in place

** ‚úÖ Biblatex
CLOSED: [2026-01-21 Wed 07:08]

- Replaces =\printbibliography= with the contents of =main.bbl=
- Comments out =\addbibresource{...}= lines

* ‚úÖ Compilation
CLOSED: [2026-01-21 Wed 07:08]

Before flattening, the module checks if your =.bbl= file is up-to-date by comparing modification times of:
- The =.tex= file
- The =.bib= file(s)
- The existing =.bbl= file

If compilation is needed, you'll be prompted:
- **Compile first** - Runs =pdflatex= + =bibtex=/=biber= to update the =.bbl=
- **Use existing .bbl** - Uses the current =.bbl= as-is

The module auto-detects whether to use =bibtex= or =biber= based on your document's packages.

* ‚úÖ Configuration
CLOSED: [2026-01-21 Wed 07:08]

| Setting                          | Default      | Description                                            |
|----------------------------------+--------------+--------------------------------------------------------|
| =scimax.manuscript.autoCompile=  | ="ask"=      | When to compile: =always=, =if-needed=, =never=, =ask= |
| =scimax.manuscript.pdflatexPath= | ="pdflatex"= | Path to pdflatex executable                            |
| =scimax.manuscript.bibtexPath=   | ="bibtex"=   | Path to bibtex executable                              |
| =scimax.manuscript.biberPath=    | ="biber"=    | Path to biber executable                               |

* ‚úÖ Workflow Example
CLOSED: [2026-01-21 Wed 07:08]

1. Open your main =.tex= file
2. Run "Scimax: Flatten Manuscript for Submission" from Command Palette
3. Choose whether to compile first (recommended if you've made recent changes)
4. Wait for processing
5. Find your submission-ready files in =submission-YYYY-MM-DD/=

* ‚úÖ What Gets Flattened
CLOSED: [2026-01-21 Wed 07:08]

** ‚úÖ Included
CLOSED: [2026-01-21 Wed 07:08]

- =\input{file}= - Content inserted directly
- =\include{file}= - Content inserted with =\clearpage= before and after
- =\includegraphics[opts]{path}= - Figures renamed and paths updated
- =\bibliography{refs}= - Replaced with =.bbl= content
- =\printbibliography= - Replaced with =.bbl= content (biblatex)

** ‚úÖ Ignored (Not Processed)
CLOSED: [2026-01-21 Wed 07:08]

- Commands inside =% comments=
- Commands inside verbatim environments (=verbatim=, =lstlisting=, =minted=)
- =\input= commands that can't be resolved (warning issued)

* ‚úÖ Warnings
CLOSED: [2026-01-21 Wed 07:08]

The module issues warnings for:
- Missing included files
- Missing figure files
- Missing =.bbl= file
- Circular includes (A includes B, B includes A)
- Maximum include depth exceeded (default: 20 levels)

Warnings are shown after flattening completes. You can review them by clicking "Show Warnings" in the success notification.

* ‚úÖ Limitations
CLOSED: [2026-01-21 Wed 07:09]

The module handles most common manuscript scenarios but has some limitations:

** ‚úÖ Not Supported
CLOSED: [2026-01-21 Wed 07:09]

| Feature                 | Description                                          | Workaround                                       |
|-------------------------+------------------------------------------------------+--------------------------------------------------|
| =\graphicspath=         | Custom figure search paths are not parsed            | Use relative paths in =\includegraphics=         |
| Custom fonts            | Font files (=.ttf=, =.otf=) are not copied           | Manually copy font files to submission directory |
| TikZ externalize        | Externalized TikZ figures (=.pdf= cache) not handled | Disable externalize or manually copy             |
| Index files             | =.ind= files from =makeindex= not copied             | Manually copy if using index                     |
| Glossary files          | =.gls= files from =makeglossaries= not copied        | Manually copy if using glossaries                |
| Multiple bibliographies | Only one =.bbl= file supported                       | Combine bibliographies before flattening         |
| Subfiles package        | =\subfile= commands not processed                    | Use =\input= instead                             |

** ‚úÖ Encoding
CLOSED: [2026-01-21 Wed 07:09]

The module assumes UTF-8 encoding for all files. Non-UTF-8 files may cause errors or produce garbled output.

** ‚úÖ Figure Detection
CLOSED: [2026-01-21 Wed 07:09]

Only =\includegraphics= commands are detected. Other figure inclusion methods are not handled:
- =\pgfimage=
- =\pdfximage=
- Raw PDF includes via =\pdfpages=

** ‚úÖ Path Resolution
CLOSED: [2026-01-21 Wed 07:09]

- Paths are resolved relative to the directory of the file containing the command
- Absolute paths are not modified
- Paths with special characters may not resolve correctly

** ‚úÖ Bibliography Edge Cases
CLOSED: [2026-01-21 Wed 07:09]

- Multiple =\printbibliography= commands: only the first is replaced with content; others are commented out
- =refsection= environments (biblatex): not handled, may produce incomplete bibliographies
- Custom =.bbl= locations: the module looks for =.bbl= alongside the main =.tex= file

** ‚úÖ Support Files
CLOSED: [2026-01-21 Wed 07:09]

Standard LaTeX packages from TeX distributions are not copied (they're assumed to be available). The module only copies files that exist in your project directory.

* Related Topics

- [[file:10-export.org][Export]] - Exporting org documents to LaTeX
- [[file:11-latex-preview.org][LaTeX Preview]] - Live preview of LaTeX documents
